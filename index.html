<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>API Data Fetcher Widget</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
    }
    input {
      width: 100%;
      margin-bottom: 10px;
      padding: 5px;
    }
  </style>
  <script>
    // Jotform widget manifest
    const manifest = {
      name: "API Data Fetcher",
      description: "Fetches data from an API and updates input fields.",
      icon: "https://cdn.jotfor.ms/assets/imgs/w-icon.png",
      fields: [],
      js_files: [],
      css_files: [],
      height: 200,
      sandbox: true
    };

    // Export manifest if running in widget builder (not used at runtime)
    if (typeof window !== "undefined" && window.parent && window.parent.setManifest) {
      window.parent.setManifest(manifest);
    }

    // Widget logic
    window.addEventListener("DOMContentLoaded", () => {
      // Create UI
      const container = document.createElement("div");
      container.innerHTML = `
        <label>Name: <input type="text" id="nameField" /></label><br/>
        <label>Email: <input type="text" id="emailField" /></label><br/>
        <label>Status: <input type="text" id="statusField" /></label>
      `;
      document.body.appendChild(container);

      // Send data to main form
      function updateFormValue() {
        const value = {
          name: document.getElementById("nameField").value,
          email: document.getElementById("emailField").value,
          status: document.getElementById("statusField").value
        };
        if (window.JFCustomWidget) {
          JFCustomWidget.setValue(value);
        }
      }

      // Fetch data from external API
      async function fetchData() {
        try {
          const response = await fetch('https://api.example.com/user'); // Replace with real API
          const data = await response.json();

          document.getElementById("nameField").value = data.name || "";
          document.getElementById("emailField").value = data.email || "";
          document.getElementById("statusField").value = data.status || "";

          updateFormValue();
        } catch (error) {
          console.error('API fetch error:', error);
          document.getElementById("statusField").value = 'Error fetching data';
        }
      }

      // Input listeners
      ['nameField', 'emailField', 'statusField'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateFormValue);
      });

      // Init
      fetchData();

      // Resize widget and ready
      if (window.JFCustomWidget) {
        JFCustomWidget.subscribe("ready", () => {
          JFCustomWidget.setHeight(200);
        });
      }
    });
  </script>
</head>
<body>
</body>
</html>
