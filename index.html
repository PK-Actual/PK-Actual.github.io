<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdn.jotfor.ms/s/umd/latest/for-custom-widgets.js"></script> <!-- JotForm Widgets-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/appwrite@17.0.0"></script> <!-- App Write SDK -->
    </head>

    <body>
        Student Name: <input id="name" type="text" name="name" value="" placeholder="John Smith"> <br/>
        Student ID: <input id="sid" type="text" name="sid" value="" placeholder="John Smith"> <br/>
        Student Email: <input id="name" type="text" name="name" value="" placeholder="smith_jo@studentkings.edu.au"> <br/>
    </body>

    <script type="text/javascript">

        JFCustomWidgetUtils.domReady(function () {

            function testWidget() {

                var appWriteClient = null;

                // Exposes functions to external calls
                this.getData = getData;
                this.setAppWriteClient = setAppWriteClient;

                function setAppWriteClient(appWriteClient){
                    this.appWriteClient = appWriteClient;
                }

                function testingAppWrite(){
                    console.log("HELLO WORLD");
                }

                function getData() {
                    return {
                        valid: true,
                        value: ""
                    };
                }
            }

            JFCustomWidget.subscribe("ready", function (data) {

                console.log("1");

                // Appwrite API Info
                const appWriteAPIKey = JFCustomWidget.getWidgetSetting('appwrite_api_key');
                const appWriteProjectID = JFCustomWidget.getWidgetSetting('appwrite_project_id');
                const appWriteEndpoint = JFCustomWidget.getWidgetSetting('appwrite_endpoint');
                const appWriteDatabaseID = JFCustomWidget.getWidgetSetting('appwrite_database_id');
                const appWriteTableID = JFCustomWidget.getWidgetSetting('appwrite_table_id');

                const client123 = new Appwrite.Client();
                client123
                    .setEndpoint(appWriteEndpoint)
                    .setProject(appWriteProjectID);
                    // .setKey(appWriteAPIKey);

                console.log("2");

                const tablesDB = new Appwrite.TablesDB(client123);

                console.log("3");

                console.log(tablesDB123);

                console.log("4");

                var widget = new testWidget();

                console.log("5");

                widget.setAppWriteClient(client123);

                console.log("6");

                JFCustomWidget.subscribe("submit", function () {
                    JFCustomWidget.sendSubmit(widget.getData());
                });
            });
        });
    </script>

</html>
