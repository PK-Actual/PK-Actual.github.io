<!DOCTYPE html>
<html>
    <head>
        <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <div id="main">
            <h3>This is my first widget.</h3>
            <h3>NOT BHEDDD! GOOD SOIZEEE!</h3>
            <span id="labelText"></span>
        <input type="text" id="sourcePostCode" class="form-textbox" value="">
        </div>
<script type="text/javascript">
        
        var input = $('#sourcePostCode');

        function postcodeValidator() {
         // exposed functions
            this.init = init;
            this.getData = getData;
            this.fillConditionValue = fillConditionValue;
         
         // initialization of the widget
            function init(formData) {
           
           // send data to Jotform on change input
                input.on('change', function() {
                    JFCustomWidget.sendData(getData());
                    JFCustomWidget.hideWidgetError();
                }); 
            }

                // USED FOR TESTING
                function getRandomInt(max) {
                    return Math.floor(Math.random() * max);
                }
         
                // fill the value set by conditions
                function fillConditionValue(data) {
                    var inputValue = data.value || '';
                    input.val(inputValue);
                    JFCustomWidget.hideWidgetError();
                    validatePostcode(inputValue)
                }

                function validatePostcode(inputValue){
                    var int_rand = getRandomInt(2);
                    if(int_rand == 1) {
                        return true;
                    } else {
                        return false;
                    }
                }
         
                // get widget data
                function getData() {
                    var inputValue = input.val();
                    var isValid = validatePostcode(inputValue)
                    console.log("isValid", isValid)
                    return {
                        value: inputValue,
                        valid: !!inputValue
                    }
                }
            }
        // always subscribe to ready event and implement widget related code
        // inside callback function , it is the best practice while developing widgets
        JFCustomWidget.subscribe("ready", function(data) {

          var label = JFCustomWidget.getWidgetSetting('QuestionLabel');
          document.getElementById('labelText').innerHTML = label;
          var widget = new postcodeValidator();
          widget.init(data);

          JFCustomWidget.subscribe("submit", function() {
            JFCustomWidget.sendSubmit(widget.getData());
          });
          
          JFCustomWidget.subscribe('populate', widget.fillConditionValue);
        });
       
        </script>
    </body>
</html>
