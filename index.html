<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdn.jotfor.ms/s/umd/latest/for-custom-widgets.js"></script> <!-- JotForm Widgets-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/appwrite@17.0.0"></script> <!-- App Write SDK -->
    </head>

    <body>
        Name: <input id="account" type="text" name="account" value="12345678">
    </body>

    <script type="text/javascript">

        import { Client, Databases, Account, Storage } from "appwrite";

        JFCustomWidgetUtils.domReady(function () {

            function testWidget() {

                var supabase = null;
                var appWriteClient = null;

                // Global variables
                // const client_id = JFCustomWidget.getWidgetSetting('client_id');
                // const client_secret = JFCustomWidget.getWidgetSetting('client_secret');
                // const token_url = "https://mdm.kings.edu.au/api/v1/auth/token"; // Jamf token creation endpoint
                // const api_url = "https://mdm.kings.edu.au/JSSResource/sites"; // Data we want to access via the API


                // Exposes functions to external calls
                this.getData = getData;
                this.testingSupabase = testingSupabase;
                this.setSupabaseObject = setSupabaseObject;
                this.setAppWriteClient = setAppWriteClient;





                function setSupabaseObject(supabaseObject){
                    this.supabase = supabaseObject;
                }

                function setAppWriteClient(appWriteClient){
                    this.appWriteClient = appWriteClient;
                }

                function testingAppWrite(){

                }


                // function testingSupabase(){

                //     this.supabase
                //         .from('Test123')
                //         .select()
                //         .then((data) => {
                //             console.log(data);
                //         });

                //     return true;
                // }

                function getData() {
                    return {
                        valid: true,
                        value: ""
                    };
                }
            }

            JFCustomWidget.subscribe("ready", function (data) {
                
                // API Related Information
                // const supabaseUrl = 'https://wqifzlurfbhlyyjyouyt.supabase.co';
                // const supabaseKey = JFCustomWidget.getWidgetSetting('supabase_key');

                const { AppWrite } = appwrite;
                

                // Appwrite API Info
                const appWriteAPIKey = JFCustomWidget.getWidgetSetting('appwrite_api_key');
                const appWriteProjectID = JFCustomWidget.getWidgetSetting('appwrite_project_id');
                const appWriteEndpoint = JFCustomWidget.getWidgetSetting('');

                const client123 = new AppWrite.Client();
                client
                    .setEndpoint(appWriteEndpoint)
                    .setProject(appWriteProjectID);
                
                const account123 = new AppWrite.Account(client);
                const tablesDB = new AppWrite.TablesDB(client);

                console.log(client123);
                console.log(account123);
                console.log(tablesDB);

                // const promise = tablesDB.listRows({
                //     databaseId: 
                // })

                // const supabase = supabase.createClient(supabaseUrl, supabaseKey);
                
                var widget = new testWidget();
                // widget.setSupabaseObject(supabase);
                widget.setAppWriteClient(client123);


                JFCustomWidget.subscribe("submit", function () {
                    JFCustomWidget.sendSubmit(widget.getData());
                });
            });
        });
    </script>

</html>
